<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lane Clash — Menu, Play, Encyclopedia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0e1220; --panel:#161b2e; --ink:#e9f1ff; --muted:#a9b7ff;
      --line:#24315c; --accent:#70d6ff;
      --blue:#58a6ff; --red:#ff6b6b; --gold:#ffd166;
      --river:#0e3a69; --riverHi:#13518f; --bridge:#6d5538;
      --lane:#1e2a5c; --laneCtr:#28377a;
    }
    *{ box-sizing:border-box; }
    html,body{ margin:0; height:100%; background:var(--bg); color:var(--ink); font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    header{ padding:12px; background:#11162b; border-bottom:1px solid var(--line); position:sticky; top:0; z-index:5; }
    .title{ font-weight:750; letter-spacing:.2px; }
    main{ max-width:1024px; margin:24px auto; padding:0 12px; }
    .panel{ background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:16px; }
    .center{ display:flex; flex-direction:column; align-items:center; gap:16px; margin-top:10vh; text-align:center; }
    .muted{ color:var(--muted); }
    .hidden{ display:none; }

    .btn{
      appearance:none; border:1px solid var(--line); background:linear-gradient(180deg,#203061,#18244b);
      color:var(--ink); padding:10px 16px; border-radius:12px; font-weight:600; cursor:pointer;
      transition:transform .08s ease, filter .12s ease, box-shadow .12s ease;
    }
    .btn:hover{ transform:translateY(-1px); filter:brightness(1.05); }

    /* Encyclopedia styles */
    .entries{ display:grid; gap:16px; }
    .entry{
      display:grid; grid-template-columns:min(360px,45%) 1fr; gap:18px; align-items:center;
      background:#0f1530; border:1px solid #27305a; border-radius:14px; padding:14px;
    }
    @media (max-width: 720px){ .entry{ grid-template-columns:1fr; } }
    .cardFrame{ display:flex; align-items:center; justify-content:center; padding:8px; background:transparent; border-radius:12px; min-height:220px; }
    .cardFrame img{ width:100%; height:auto; display:block; }
    .details h2{ margin:0 0 8px; font-size:22px; display:flex; align-items:center; gap:8px; }
    .pill{ display:inline-block; padding:2px 10px; border-radius:999px; background:#0b1433; border:1px solid #20306a; font-size:12px; }
    .grid{ display:grid; grid-template-columns:120px 1fr; gap:8px 12px; margin:8px 0 10px; }
    .label{ color:#9fb4ff; }
    .desc{ color:#cfe1ff; }

    /* HUD bars */
    .hud{ display:flex; align-items:center; gap:16px; padding:8px 12px; background:#0f1530; border:1px solid #27305a; border-radius:12px; margin-bottom:12px; }
    .badge{ padding:2px 10px; border-radius:999px; font-size:12px; border:1px solid #20306a; }
    .blue{ background:rgba(88,166,255,.12); color:var(--blue); }
    .red{ background:rgba(255,107,107,.12); color:var(--red); }
    .bar{ position:relative; width:220px; height:14px; border:1px solid #2c355c; border-radius:999px; background:#0b0f1c; overflow:hidden; }
    .fill{ position:absolute; inset:0; transform-origin:left center; background:linear-gradient(90deg,#2b68ff,#70d6ff); }
    .fill.red{ background:linear-gradient(90deg,#ff7b7b,#ffb3a3); }
    .barlabel{ font-variant-numeric:tabular-nums; min-width:2ch; text-align:right; }

    /* Canvas (taller now) */
    canvas{ width:100%; height:720px; display:block; border-radius:12px; background:#0b1026; border:1px solid #27305a; }
    .toolbar{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
  </style>
</head>
<body>
  <header><div class="title">Lane Clash — Prototype</div></header>

  <main>
    <!-- MAIN MENU -->
    <section id="menu" class="panel center" aria-labelledby="menuTitle">
      <h1 id="menuTitle" style="position:absolute;left:-9999px;">Main Menu</h1>
      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        <button id="playBtn" class="btn">Play</button>
        <button id="openEncy" class="btn" aria-controls="ency" aria-expanded="false">Encyclopedia</button>
      </div>
      <p class="muted">Start a match (towers only) or browse unit cards.</p>
    </section>

    <!-- PLAY -->
    <section id="play" class="panel hidden" aria-labelledby="playTitle">
      <div class="toolbar">
        <h2 id="playTitle" style="margin:0;">Play — Blue (You) at Bottom vs Red (AI) at Top</h2>
        <button id="backFromPlay" class="btn">Back</button>
      </div>

      <div class="hud" role="group" aria-label="Elixir HUD">
        <span class="badge blue">Blue (You)</span>
        <div class="bar" aria-label="Blue Elixir"><div id="blueFill" class="fill"></div></div>
        <span id="blueText" class="barlabel">0</span>
        <span class="badge red" style="margin-left:18px;">Red (AI)</span>
        <div class="bar" aria-label="Red Elixir"><div id="redFill" class="fill red"></div></div>
        <span id="redText" class="barlabel">0</span>
        <span class="muted" style="margin-left:auto;">Regen: 1 / 2s (max 10)</span>
      </div>

      <canvas id="game" width="960" height="720" aria-label="Battlefield"></canvas>
      <p class="muted" style="margin-top:10px;">Crossbows are placed further from the river; they only target on their own half. Numeric HP shown above bars.</p>
    </section>

    <!-- ENCYCLOPEDIA -->
    <section id="ency" class="panel hidden" aria-labelledby="encyTitle">
      <div class="toolbar">
        <h2 id="encyTitle" style="margin:0;">Encyclopedia</h2>
        <button id="backBtn" class="btn">Back</button>
      </div>
      <div class="entries">
        <!-- KNIGHT -->
        <article class="entry" role="article" aria-labelledby="knightTitle">
          <div class="cardFrame">
            <img src="assets/Knight.png" alt="Knight card (Common, Cost 2)"
                 onerror="this.alt='Knight card image not found'; this.style.opacity=.6;">
          </div>
          <div class="details">
            <h2 id="knightTitle">Knight <span class="pill">Common</span></h2>
            <div class="grid" aria-label="Knight stats">
              <div class="label">Elixir Cost</div><div>2</div>
              <div class="label">HP</div><div>100</div>
              <div class="label">DMG</div><div>20 / sec</div>
              <div class="label">Speed</div><div>1</div>
              <div class="label">Unit Count</div><div>1</div>
            </div>
            <p class="desc">A brave melee fighter with balanced stats and solid defense—trusty and reliable on the battlefield.</p>
          </div>
        </article>

        <!-- ARCHERS -->
        <article class="entry" role="article" aria-labelledby="archersTitle">
          <div class="cardFrame" style="border:1px dashed #27305a;">
            <img src="assets/Archers.png" alt="Archers card (Common, Cost 2)"
                 onerror="this.replaceWith(Object.assign(document.createElement('span'),{textContent:'Archers card art coming soon',className:'muted'}));">
          </div>
          <div class="details">
            <h2 id="archersTitle">Archers <span class="pill">Common</span></h2>
            <div class="grid" aria-label="Archers stats">
              <div class="label">Elixir Cost</div><div>2</div>
              <div class="label">HP</div><div>60</div>
              <div class="label">DMG</div><div>15 / 0.5s</div>
              <div class="label">Speed</div><div>1.5</div>
              <div class="label">Unit Count</div><div>2</div>
            </div>
            <p class="desc">Paired ranged attackers that pepper targets from a safe distance—light armor, high utility.</p>
          </div>
        </article>

        <!-- MINI-MEGA -->
        <article class="entry" role="article" aria-labelledby="miniMegaTitle">
          <div class="cardFrame" style="border:1px dashed #27305a;">
            <img src="assets/Mini-MEGA.png" alt="Mini-MEGA card (Common, Cost 3)"
                 onerror="this.replaceWith(Object.assign(document.createElement('span'),{textContent:'Mini-MEGA card art coming soon',className:'muted'}));">
          </div>
          <div class="details">
            <h2 id="miniMegaTitle">Mini-MEGA <span class="pill">Common</span></h2>
            <div class="grid" aria-label="Mini-MEGA stats">
              <div class="label">Elixir Cost</div><div>3</div>
              <div class="label">HP</div><div>300</div>
              <div class="label">DMG</div><div>80 / 1.5s</div>
              <div class="label">Speed</div><div>0.75</div>
              <div class="label">Unit Count</div><div>1</div>
            </div>
            <p class="desc">A compact but tanky robot with surprising punch power. Slow stride, heavy hit.</p>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script>
    // ===== Scene switching =====
    const menu = document.getElementById('menu');
    const play = document.getElementById('play');
    const ency = document.getElementById('ency');
    const playBtn = document.getElementById('playBtn');
    const backFromPlay = document.getElementById('backFromPlay');
    const openEncy = document.getElementById('openEncy');
    const backBtn = document.getElementById('backBtn');

    function show(el){
      menu.classList.add('hidden');
      play.classList.add('hidden');
      ency.classList.add('hidden');
      el.classList.remove('hidden');
      window.scrollTo(0,0);
    }
    playBtn.onclick = () => show(play);
    backFromPlay.onclick = () => show(menu);
    openEncy.onclick = () => show(ency);
    backBtn.onclick = () => show(menu);

    // ===== PLAY: flipped arena + taller map + river/bridges + towers + projectiles + elixir =====
    const W = 960, H = 720;
    const canv = document.getElementById('game');
    const ctx = canv.getContext('2d');

    // HUD refs
    const blueFill = document.getElementById('blueFill');
    const redFill  = document.getElementById('redFill');
    const blueText = document.getElementById('blueText');
    const redText  = document.getElementById('redText');

    // Elixir
    const ELIXIR_MAX = 10;
    const ELIXIR_PER_SEC = 0.5; // 1 every 2 sec
    const elixir = { blue: 5, red: 5 };

    // Battlefield layout (taller)
    const riverY = H/2, riverH = 100;
    const lanesX = [ W*0.33, W*0.67 ];
    const bridgeW = 120, bridgeH = riverH + 18;

    function drawBattlefield(){
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle = '#0b1026'; ctx.fillRect(0,0,W,H);

      // Ground halves
      ctx.fillStyle = '#0c1431'; ctx.fillRect(0, 0, W, riverY - riverH/2);
      ctx.fillRect(0, riverY + riverH/2, W, H - (riverY + riverH/2));

      // River
      const grad = ctx.createLinearGradient(0, riverY-riverH/2, 0, riverY+riverH/2);
      grad.addColorStop(0, getCSS('--riverHi'));
      grad.addColorStop(1, getCSS('--river'));
      ctx.fillStyle = grad;
      ctx.fillRect(0, riverY - riverH/2, W, riverH);

      // Bridges
      ctx.fillStyle = getCSS('--bridge');
      for (const x of lanesX){
        roundedRect(x - bridgeW/2, riverY - bridgeH/2, bridgeW, bridgeH, 10);
        ctx.fill();
        // board lines
        ctx.strokeStyle = 'rgba(0,0,0,0.35)';
        ctx.lineWidth = 2;
        for (let i=-3;i<=3;i++){
          const bx = x + (i*bridgeW/7);
          ctx.beginPath();
          ctx.moveTo(bx, riverY-bridgeH/2+6);
          ctx.lineTo(bx, riverY+bridgeH/2-6);
          ctx.stroke();
        }
      }

      // Lane guide lines (vertical)
      for (const x of lanesX){
        ctx.strokeStyle = getCSS('--lane'); ctx.lineWidth = 22;
        ctx.beginPath(); ctx.moveTo(x, 40); ctx.lineTo(x, H-40); ctx.stroke();
        ctx.strokeStyle = getCSS('--laneCtr'); ctx.lineWidth = 2; ctx.setLineDash([8,8]);
        ctx.beginPath(); ctx.moveTo(x, 40); ctx.lineTo(x, H-40); ctx.stroke(); ctx.setLineDash([]);
      }
    }

    // Towers (bottom = blue human, top = red AI)
    function tKing(side, x, y){ return {type:'king', side, x, y, r:26, hp:1200, rof:1.6, range:260, cd:0}; }
    function tXbow(side, x, y){ return {type:'xbow', side, x, y, r:16, hp:600,  rof:1.1, range:300, cd:0}; }

    const towers = [
      // BLUE (bottom)
      tKing('blue', W/2, H-100),
      tXbow('blue', lanesX[0], H-280),  // further from river
      tXbow('blue', lanesX[1], H-280),
      // RED (top)
      tKing('red',  W/2, 100),
      tXbow('red',  lanesX[0], 280),    // further from river
      tXbow('red',  lanesX[1], 280),
    ];

    // Projectiles
    const projectiles = []; // {x,y,vx,vy,spd,dmg,target}
    function spawnBolt(from, target, dmg=30, spd=360){
      const ang = Math.atan2(target.y - from.y, target.x - from.x);
      projectiles.push({ x: from.x, y: from.y, vx: Math.cos(ang), vy: Math.sin(ang), spd, dmg, target });
    }

    // Helpers
    function dist(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy); }
    function enemiesOf(side){ return towers.filter(t => t.side !== side && t.hp > 0); }
    function roundedRect(x,y,w,h,r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y,   x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x,   y+h, r);
      ctx.arcTo(x,   y+h, x,   y,   r);
      ctx.arcTo(x,   y,   x+w, y,   r);
      ctx.closePath();
    }
    function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim() || '#fff'; }

    // Crossbow vertical bands: only their half (from their side of river to their king)
    function xbowBandFor(t){
      if (t.side === 'blue'){
        return { yMin: riverY + riverH/2, yMax: H }; // bottom half
      } else {
        return { yMin: 0, yMax: riverY - riverH/2 }; // top half
      }
    }

    function drawTower(t){
      const col = t.side === 'blue' ? getCSS('--blue') : getCSS('--red');

      if (t.type === 'king'){
        // shadow
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.beginPath(); ctx.ellipse(t.x, t.y+28, 36, 12, 0, 0, Math.PI*2); ctx.fill();

        // body
        ctx.fillStyle = col; ctx.strokeStyle = '#0a0f25'; ctx.lineWidth = 3;
        roundedRect(t.x-28, t.y-36, 56, 72, 10); ctx.fill(); ctx.stroke();

        // crown
        ctx.fillStyle = getCSS('--gold'); ctx.strokeStyle = '#7a5a00';
        ctx.beginPath();
        const cw=30;
        ctx.moveTo(t.x - cw/2, t.y - 40);
        ctx.lineTo(t.x - cw/6, t.y - 28);
        ctx.lineTo(t.x,        t.y - 38);
        ctx.lineTo(t.x + cw/6, t.y - 28);
        ctx.lineTo(t.x + cw/2, t.y - 40);
        ctx.closePath(); ctx.fill(); ctx.stroke();
      } else {
        // crossbow
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.beginPath(); ctx.ellipse(t.x, t.y+18, 26, 9, 0, 0, Math.PI*2); ctx.fill();

        ctx.fillStyle = col; ctx.strokeStyle = '#0a0f25'; ctx.lineWidth = 3;
        roundedRect(t.x-18, t.y-22, 36, 44, 8); ctx.fill(); ctx.stroke();

        // bow arm
        ctx.strokeStyle = '#c9cedd'; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(t.x-20, t.y-4); ctx.lineTo(t.x+20, t.y-4); ctx.stroke();
      }

      // HP UI (bar + numeric label)
      const maxHP = (t.type==='king')?1200:600;
      const pct = Math.max(0, Math.min(1, t.hp/maxHP));
      const w = 60, h=6, bx=t.x-w/2, by=t.y-(t.type==='king'?52:38);
      ctx.fillStyle='#0a1129'; ctx.fillRect(bx,by,w,h);
      ctx.fillStyle='#6bff95'; ctx.fillRect(bx,by,w*pct,h);
      ctx.strokeStyle='#0a0f25'; ctx.strokeRect(bx,by,w,h);

      // numeric HP
      ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom';
      ctx.fillStyle = '#dfe7ff';
      ctx.fillText(Math.max(0, Math.ceil(t.hp)), t.x, by-2);
    }

    function towerAI(t, dt){
      if (t.hp <= 0) return;
      t.cd -= dt; if (t.cd > 0) return;

      // choose enemies in range
      const enemies = enemiesOf(t.side);
      let best=null, bestD=1e9;

      for (const e of enemies){
        // base distance check
        const d = dist(t,e);
        if (d >= t.range) continue;

        // crossbows: clamp to their own vertical half only
        if (t.type === 'xbow'){
          const band = xbowBandFor(t);
          if (e.y < band.yMin || e.y > band.yMax) continue;
        }
        // pick nearest valid
        if (d < bestD){ best=e; bestD=d; }
      }

      if (best){
        spawnBolt(t, best, (t.type==='king'?40:30), (t.type==='king'?340:380));
        t.cd = t.rof;
      }
    }

    function updateProjectiles(dt){
      for (const p of projectiles){
        const tgt = p.target;
        if (!tgt || tgt.hp <= 0) { p.dead = true; continue; }
        const dirx = tgt.x - p.x, diry = tgt.y - p.y;
        const len = Math.hypot(dirx, diry) || 1;
        p.vx = dirx/len; p.vy = diry/len;
        p.x += p.vx * p.spd * dt;
        p.y += p.vy * p.spd * dt;
        // hit check
        if (Math.hypot(tgt.x - p.x, tgt.y - p.y) <= (tgt.r+6)){
          tgt.hp -= p.dmg;
          p.dead = true;
        }
      }
      // prune
      for (let i=projectiles.length-1;i>=0;i--) if (projectiles[i].dead) projectiles.splice(i,1);
    }

    function drawProjectiles(){
      ctx.fillStyle = '#ffd166';
      for (const p of projectiles){
        ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
      }
    }

    function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim() || '#fff'; }

    // Main loop
    let last = performance.now();
    function loop(now){
      const dt = Math.min(0.033, (now - last) / 1000); last = now;

      // elixir regen (1 per 2s)
      elixir.blue = Math.min(ELIXIR_MAX, elixir.blue + ELIXIR_PER_SEC*dt);
      elixir.red  = Math.min(ELIXIR_MAX, elixir.red  + ELIXIR_PER_SEC*dt);
      blueFill.style.transform = `scaleX(${elixir.blue/ELIXIR_MAX})`;
      redFill .style.transform = `scaleX(${elixir.red /ELIXIR_MAX})`;
      blueText.textContent = Math.floor(elixir.blue);
      redText .textContent = Math.floor(elixir.red);

      // Towers think + fire
      for (const t of towers) towerAI(t, dt);

      // Projectiles
      updateProjectiles(dt);

      // Draw
      drawBattlefield();
      for (const t of towers) drawTower(t);
      drawProjectiles();

      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  </script>
</body>
</html>
